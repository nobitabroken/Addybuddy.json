<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customize Agent - AI Agent Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/material-darker.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .CodeMirror { height: 400px; font-size: 14px; }
        .tab-active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-4px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="bg-gray-50 text-gray-900">
    <!-- Download Button -->
    <div class="download-btn">
        <button onclick="downloadApp()" class="bg-green-600 text-white p-3 rounded-full shadow-lg hover:bg-green-700 transition-all pulse-glow" title="Download AI Agent Hub App">
            <i class="fas fa-download text-xl"></i>
        </button>
    </div>

    <!-- Navigation -->
    <nav class="bg-white shadow-lg fixed w-full top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-2xl font-bold text-indigo-600">AI Agent Hub</h1>
                    </div>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="index.html" class="px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100">Home</a>
                        <a href="create-agent.html" class="px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100">Create Agent</a>
                        <a href="customize.html" class="px-3 py-2 rounded-md text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700">Customize</a>
                        <a href="marketplace.html" class="px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100">Marketplace</a>
                        <a href="dashboard.html" class="px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100">Dashboard</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="pt-20 min-h-screen bg-gradient-to-br from-gray-50 to-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <!-- Header -->
            <div class="text-center mb-12">
                <h1 class="text-4xl font-bold text-gray-900 mb-4">Advanced Agent Customization</h1>
                <p class="text-xl text-gray-600">Fine-tune your AI agent with custom code and advanced configurations</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Agent Selection Sidebar -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-2xl shadow-xl p-6 sticky top-24">
                        <h3 class="text-xl font-bold text-gray-900 mb-6">Select Agent to Customize</h3>
                        <div id="agentList" class="space-y-3">
                            <!-- Agents will be populated by JavaScript -->
                        </div>
                        
                        <div class="mt-8 pt-6 border-t border-gray-200">
                            <h4 class="font-semibold text-gray-900 mb-4">Quick Actions</h4>
                            <div class="space-y-2">
                                <button onclick="createNewAgent()" class="w-full text-left px-4 py-3 text-sm bg-indigo-50 text-indigo-700 rounded-lg hover:bg-indigo-100 transition-colors">
                                    <i class="fas fa-plus mr-2"></i>Create New Agent
                                </button>
                                <button onclick="importAgent()" class="w-full text-left px-4 py-3 text-sm bg-green-50 text-green-700 rounded-lg hover:bg-green-100 transition-colors">
                                    <i class="fas fa-download mr-2"></i>Import Agent Config
                                </button>
                                <button onclick="exportAgent()" class="w-full text-left px-4 py-3 text-sm bg-purple-50 text-purple-700 rounded-lg hover:bg-purple-100 transition-colors">
                                    <i class="fas fa-upload mr-2"></i>Export Agent Config
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Code Editor -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-2xl shadow-xl p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-gray-900">Code Editor</h3>
                            <div class="flex space-x-2">
                                <button onclick="runCode()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                                    <i class="fas fa-play mr-2"></i>Run
                                </button>
                                <button onclick="saveCode()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                    <i class="fas fa-save mr-2"></i>Save
                                </button>
                            </div>
                        </div>

                        <!-- Code Tabs -->
                        <div class="flex space-x-1 mb-4 bg-gray-100 rounded-lg p-1">
                            <button onclick="switchTab('behavior')" id="behaviorTab" class="tab-btn flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors tab-active text-white">
                                Behavior Logic
                            </button>
                            <button onclick="switchTab('responses')" id="responsesTab" class="tab-btn flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors text-gray-600 hover:text-gray-900">
                                Response Templates
                            </button>
                            <button onclick="switchTab('api')" id="apiTab" class="tab-btn flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors text-gray-600 hover:text-gray-900">
                                API Integration
                            </button>
                            <button onclick="switchTab('advanced')" id="advancedTab" class="tab-btn flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors text-gray-600 hover:text-gray-900">
                                Advanced Config
                            </button>
                        </div>

                        <!-- Code Editor -->
                        <div class="border border-gray-200 rounded-lg overflow-hidden">
                            <textarea id="codeEditor" placeholder="// Start coding your custom agent behavior here..."></textarea>
                        </div>

                        <!-- Output Panel -->
                        <div class="mt-6">
                            <h4 class="font-semibold text-gray-900 mb-3">Output & Logs</h4>
                            <div id="outputPanel" class="bg-gray-900 text-green-400 p-4 rounded-lg h-32 overflow-y-auto font-mono text-sm">
                                <div class="text-gray-500">// Agent customization ready. Select an agent to start editing...</div>
                            </div>
                        </div>
                    </div>

                    <!-- Customization Options -->
                    <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Personality Tuning -->
                        <div class="bg-white rounded-2xl shadow-xl p-6 card-hover">
                            <h3 class="text-lg font-bold text-gray-900 mb-4">
                                <i class="fas fa-brain text-purple-600 mr-2"></i>Personality Tuning
                            </h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Creativity Level</label>
                                    <input type="range" id="creativity" min="0" max="100" value="50" class="w-full">
                                    <div class="flex justify-between text-xs text-gray-500">
                                        <span>Conservative</span>
                                        <span>Creative</span>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Response Length</label>
                                    <select id="responseLength" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                        <option value="short">Short (1-2 sentences)</option>
                                        <option value="medium" selected>Medium (3-5 sentences)</option>
                                        <option value="long">Long (6+ sentences)</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Formality Level</label>
                                    <input type="range" id="formality" min="0" max="100" value="70" class="w-full">
                                    <div class="flex justify-between text-xs text-gray-500">
                                        <span>Casual</span>
                                        <span>Formal</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Knowledge Base -->
                        <div class="bg-white rounded-2xl shadow-xl p-6 card-hover">
                            <h3 class="text-lg font-bold text-gray-900 mb-4">
                                <i class="fas fa-database text-blue-600 mr-2"></i>Knowledge Base
                            </h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Update Frequency</label>
                                    <select id="updateFreq" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                        <option value="realtime">Real-time</option>
                                        <option value="hourly">Hourly</option>
                                        <option value="daily" selected>Daily</option>
                                        <option value="weekly">Weekly</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Data Sources</label>
                                    <div class="space-y-2">
                                        <label class="flex items-center">
                                            <input type="checkbox" class="mr-2" checked> Website Content
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" class="mr-2" checked> Uploaded Documents
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" class="mr-2"> External APIs
                                        </label>
                                    </div>
                                </div>
                                <button onclick="syncKnowledgeBase()" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                    <i class="fas fa-sync mr-2"></i>Sync Knowledge Base
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div id="importModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 max-w-md mx-4">
            <h3 class="text-xl font-bold text-gray-900 mb-4">Import Agent Configuration</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Upload JSON File</label>
                    <input type="file" id="importFile" accept=".json" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Or Paste Configuration</label>
                    <textarea id="importText" rows="6" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="Paste your JSON configuration here..."></textarea>
                </div>
                <div class="flex space-x-3">
                    <button onclick="processImport()" class="flex-1 bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition-colors">
                        Import
                    </button>
                    <button onclick="closeImportModal()" class="flex-1 border-2 border-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-50 transition-colors">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Download app function
        function downloadApp() {
            const appData = {
                name: "AI Agent Hub",
                version: "1.0.0",
                description: "World's Top 20 AI Agents in one platform",
                features: ["20+ Top AI Agents", "Interactive Demo Mode", "Advanced Customization", "Performance Analytics", "Community Features"]
            };

            const dataStr = JSON.stringify(appData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `AI_Agent_Hub_v1.0.0.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            alert('ðŸŽ‰ AI Agent Hub app downloaded successfully!\n\nThe app includes:\nâ€¢ All 20 top AI agents\nâ€¢ Interactive demo mode\nâ€¢ Advanced customization tools\nâ€¢ Performance analytics\nâ€¢ Community features\n\nInstall and start using the world\'s best AI agents today!');
        }

        let codeEditor;
        let currentAgent = null;
        let currentTab = 'behavior';

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeCodeEditor();
            loadAgents();
            loadDefaultCode();
        });

        function initializeCodeEditor() {
            codeEditor = CodeMirror.fromTextArea(document.getElementById('codeEditor'), {
                lineNumbers: true,
                mode: 'javascript',
                theme: 'material-darker',
                autoCloseBrackets: true,
                matchBrackets: true,
                indentUnit: 4,
                lineWrapping: true
            });

            codeEditor.on('change', function() {
                addToOutput('Code updated...', 'info');
            });
        }

        function loadAgents() {
            const agents = JSON.parse(localStorage.getItem('agents') || '[]');
            const agentList = document.getElementById('agentList');
            
            if (agents.length === 0) {
                agentList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-robot text-4xl mb-4"></i>
                        <p>No agents created yet.</p>
                        <button onclick="createNewAgent()" class="mt-2 text-indigo-600 hover:text-indigo-700">
                            Create your first agent
                        </button>
                    </div>
                `;
                return;
            }

            agentList.innerHTML = agents.map(agent => `
                <div class="agent-item p-3 border border-gray-200 rounded-lg cursor-pointer hover:border-indigo-500 hover:bg-indigo-50 transition-colors" 
                     onclick="selectAgent('${agent.id}')">
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="font-semibold text-gray-900">${agent.name}</h4>
                            <p class="text-sm text-gray-600">${agent.agentType} â€¢ ${agent.status}</p>
                        </div>
                        <div class="w-3 h-3 rounded-full ${agent.status === 'active' ? 'bg-green-500' : 'bg-yellow-500'}"></div>
                    </div>
                </div>
            `).join('');
        }

        function selectAgent(agentId) {
            const agents = JSON.parse(localStorage.getItem('agents') || '[]');
            currentAgent = agents.find(a => a.id == agentId);
            
            if (currentAgent) {
                // Highlight selected agent
                document.querySelectorAll('.agent-item').forEach(item => {
                    item.classList.remove('border-indigo-500', 'bg-indigo-50');
                });
                event.target.closest('.agent-item').classList.add('border-indigo-500', 'bg-indigo-50');
                
                addToOutput(`Selected agent: ${currentAgent.name}`, 'success');
                loadAgentCode();
            }
        }

        function loadAgentCode() {
            if (!currentAgent) return;
            
            const codeTemplates = {
                behavior: getBehaviorCode(),
                responses: getResponsesCode(),
                api: getApiCode(),
                advanced: getAdvancedCode()
            };
            
            switchTab('behavior');
            codeEditor.setValue(codeTemplates.behavior);
        }

        function loadDefaultCode() {
            codeEditor.setValue(`// Welcome to AI Agent Builder Code Editor!
// Customize your agent's behavior with JavaScript

class CustomAgent {
    constructor(config) {
        this.name = config.name || 'AI Assistant';
        this.personality = config.personality || 'friendly';
        this.knowledgeBase = config.knowledgeBase || [];
    }

    // Process user input and generate response
    async processMessage(userInput, context = {}) {
        // Add your custom logic here
        const response = {
            message: '',
            confidence: 0.95,
            suggestedActions: []
        };
        
        return response;
    }

    // Handle special commands
    handleCommand(command, args) {
        switch(command) {
            case 'help':
                return this.getHelpMessage();
            case 'status':
                return this.getStatus();
            default:
                return 'Unknown command';
        }
    }

    getHelpMessage() {
        return \`Hi! I'm \${this.name}. I can help you with various tasks. 
        Try asking me questions or use commands like '/help' or '/status'.\`;
    }
}

// Export your custom agent
module.exports = CustomAgent;`);
        }

        function getBehaviorCode() {
            return `// ${currentAgent.name} - Behavior Logic
class ${currentAgent.name.replace(/\s+/g, '')}Agent {
    constructor() {
        this.name = "${currentAgent.name}";
        this.type = "${currentAgent.agentType}";
        this.personality = {
            style: "${currentAgent.communicationStyle || 'friendly'}",
            tone: "${currentAgent.tone || 'helpful'}",
            creativity: ${document.getElementById('creativity')?.value || 50},
            formality: ${document.getElementById('formality')?.value || 70}
        };
    }

    async generateResponse(userInput, context) {
        // Implement your custom response logic here
        const prompt = \`You are \${this.name}, a \${this.type} agent. 
                       Personality: \${this.personality.style}, \${this.personality.tone}.
                       User message: \${userInput}
                       Context: \${JSON.stringify(context)}\`;
        
        return {
            message: "Custom response based on your configuration",
            confidence: 0.9,
            metadata: {
                responseTime: Date.now(),
                personality: this.personality
            }
        };
    }
}`;
        }

        function getResponsesCode() {
            return `// ${currentAgent.name} - Response Templates
const responseTemplates = {
    greeting: [
        "Hello! I'm {agentName}, your {agentType} assistant. How can I help you today?",
        "Hi there! Welcome to our service. I'm here to assist you.",
        "Greetings! I'm ready to help you with any questions or tasks you have."
    ],
    
    fallback: [
        "I apologize, but I don't understand that request. Could you please rephrase?",
        "I'm not sure I follow. Let me try to help in a different way.",
        "That's a great question! Let me get more information to assist you better."
    ],
    
    error: [
        "I encountered an issue while processing your request. Please try again.",
        "Something went wrong on my end. Let me try a different approach.",
        "I apologize for the technical difficulty. Please give me a moment to resolve this."
    ],
    
    confirmation: [
        "Perfect! I've processed your request successfully.",
        "Great! Everything is all set on my end.",
        "Excellent! Your request has been completed."
    ]
};

// Dynamic response generator
function generateResponse(template, variables = {}) {
    let response = template[Math.floor(Math.random() * template.length)];
    
    // Replace variables
    Object.keys(variables).forEach(key => {
        response = response.replace(new RegExp(\`{\\${key}}\`, 'g'), variables[key]);
    });
    
    return response;
}

module.exports = { responseTemplates, generateResponse };`;
        }

        function getApiCode() {
            return `// ${currentAgent.name} - API Integration
const axios = require('axios');

class APIIntegration {
    constructor(config) {
        this.baseURL = config.baseURL || '';
        this.apiKey = config.apiKey || '';
        this.endpoints = config.endpoints || {};
    }

    async fetchData(endpoint, params = {}) {
        try {
            const response = await axios.get(\`\${this.baseURL}\${endpoint}\`, {
                headers: {
                    'Authorization': \`Bearer \${this.apiKey}\`,
                    'Content-Type': 'application/json'
                },
                params
            });
            
            return response.data;
        } catch (error) {
            console.error('API fetch error:', error);
            return null;
        }
    }

    async postData(endpoint, data = {}) {
        try {
            const response = await axios.post(\`\${this.baseURL}\${endpoint}\`, data, {
                headers: {
                    'Authorization': \`Bearer \${this.apiKey}\`,
                    'Content-Type': 'application/json'
                }
            });
            
            return response.data;
        } catch (error) {
            console.error('API post error:', error);
            return null;
        }
    }

    // Webhook handler
    async handleWebhook(payload) {
        // Process incoming webhook data
        console.log('Webhook received:', payload);
        
        // Add your webhook processing logic here
        return { success: true, processed: true };
    }
}

module.exports = APIIntegration;`;
        }

        function getAdvancedCode() {
            return `// ${currentAgent.name} - Advanced Configuration
const advancedConfig = {
    // Machine Learning Settings
    ml: {
        model: 'gpt-4',
        temperature: 0.7,
        maxTokens: 150,
        topP: 1.0,
        frequencyPenalty: 0.0,
        presencePenalty: 0.0,
        stopSequences: ['\n', 'Human:', 'AI:']
    },

    // Memory Settings
    memory: {
        enabled: true,
        maxContextLength: 4096,
        conversationHistory: true,
        userProfile: true,
        sessionTimeout: 3600000 // 1 hour
    },

    // Performance Settings
    performance: {
        cacheEnabled: true,
        cacheTtl: 3600,
        rateLimit: {
            requestsPerMinute: 60,
            burstLimit: 10
        },
        responseTimeout: 30000
    },

    // Security Settings
    security: {
        inputSanitization: true,
        outputFiltering: true,
        piiDetection: true,
        contentModeration: true,
        allowedDomains: [],
        blockedPatterns: []
    },

    // Integration Settings
    integrations: {
        webhooks: [],
        databases: [],
        externalAPIs: [],
        analytics: {
            enabled: true,
            provider: 'internal'
        }
    }
};

// Custom middleware functions
const middleware = {
    preProcess: async (input, context) => {
        // Process input before sending to AI model
        return { input, context };
    },

    postProcess: async (response, context) => {
        // Process response before sending to user
        return { response, context };
    },

    errorHandler: async (error, context) => {
        // Handle errors gracefully
        console.error('Agent error:', error);
        return {
            message: 'I apologize, but I encountered an error. Please try again.',
            error: error.message
        };
    }
};

module.exports = { advancedConfig, middleware };`;
        }

        function switchTab(tab) {
            currentTab = tab;
            
            // Update tab appearance
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('tab-active', 'text-white');
                btn.classList.add('text-gray-600');
            });
            
            const activeTab = document.getElementById(tab + 'Tab');
            activeTab.classList.add('tab-active', 'text-white');
            activeTab.classList.remove('text-gray-600');
            
            // Load corresponding code
            if (currentAgent) {
                const codeTemplates = {
                    behavior: getBehaviorCode(),
                    responses: getResponsesCode(),
                    api: getApiCode(),
                    advanced: getAdvancedCode()
                };
                
                codeEditor.setValue(codeTemplates[tab]);
                addToOutput(`Switched to ${tab} editor`, 'info');
            }
        }

        function runCode() {
            const code = codeEditor.getValue();
            addToOutput('Running code...', 'info');
            addToOutput('Code execution simulated. In production, this would execute your custom agent logic.', 'success');
            
            // Simulate code execution
            try {
                // In a real implementation, this would execute the code safely
                addToOutput('âœ… Code syntax check passed', 'success');
                addToOutput('ðŸ“Š Agent behavior updated successfully', 'success');
            } catch (error) {
                addToOutput(`âŒ Error: ${error.message}`, 'error');
            }
        }

        function saveCode() {
            if (!currentAgent) {
                addToOutput('Please select an agent first', 'error');
                return;
            }
            
            const code = codeEditor.getValue();
            const agents = JSON.parse(localStorage.getItem('agents') || '[]');
            
            const agentIndex = agents.findIndex(a => a.id == currentAgent.id);
            if (agentIndex !== -1) {
                agents[agentIndex].customCode = agents[agentIndex].customCode || {};
                agents[agentIndex].customCode[currentTab] = code;
                localStorage.setItem('agents', JSON.stringify(agents));
                
                addToOutput(`Code saved for ${currentAgent.name} (${currentTab})`, 'success');
            }
        }

        function addToOutput(message, type = 'info') {
            const output = document.getElementById('outputPanel');
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = {
                info: 'text-blue-400',
                success: 'text-green-400',
                error: 'text-red-400',
                warning: 'text-yellow-400'
            }[type] || 'text-gray-400';
            
            output.innerHTML += `<div class="${colorClass}">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }

        function createNewAgent() {
            window.location.href = 'create-agent.html';
        }

        function importAgent() {
            document.getElementById('importModal').classList.remove('hidden');
            document.getElementById('importModal').classList.add('flex');
        }

        function closeImportModal() {
            document.getElementById('importModal').classList.add('hidden');
            document.getElementById('importModal').classList.remove('flex');
        }

        function processImport() {
            const fileInput = document.getElementById('importFile');
            const textInput = document.getElementById('importText');
            
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const config = JSON.parse(e.target.result);
                        importAgentConfig(config);
                    } catch (error) {
                        addToOutput('Error parsing JSON file', 'error');
                    }
                };
                reader.readAsText(file);
            } else if (textInput.value.trim()) {
                try {
                    const config = JSON.parse(textInput.value);
                    importAgentConfig(config);
                } catch (error) {
                    addToOutput('Error parsing JSON text', 'error');
                }
            }
            
            closeImportModal();
        }

        function importAgentConfig(config) {
            const agents = JSON.parse(localStorage.getItem('agents') || '[]');
            config.id = Date.now();
            config.importedAt = new Date().toISOString();
            agents.push(config);
            localStorage.setItem('agents', JSON.stringify(agents));
            
            addToOutput(`Agent configuration imported: ${config.name}`, 'success');
            loadAgents();
        }

        function exportAgent() {
            if (!currentAgent) {
                addToOutput('Please select an agent to export', 'error');
                return;
            }
            
            const dataStr = JSON.stringify(currentAgent, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `${currentAgent.name.replace(/\s+/g, '_')}_config.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            addToOutput(`Agent configuration exported: ${exportFileDefaultName}`, 'success');
        }

        function syncKnowledgeBase() {
            addToOutput('Syncing knowledge base...', 'info');
            // Simulate sync process
            setTimeout(() => {
                addToOutput('Knowledge ba