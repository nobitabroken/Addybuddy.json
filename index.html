<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>AI Agent Hub — Integrated AI Tools</title>
  <link rel="icon" href="data:,">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/typed.js/2.0.12/typed.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:#f8fafc}
    .card{background:#fff;border-radius:12px;padding:16px;box-shadow:0 6px 20px rgba(2,6,23,0.06)}
    .small{font-size:.85rem}
    textarea{resize:vertical}
    .kbd{background:#f3f4f6;border:1px solid #e5e7eb;padding:3px 7px;border-radius:6px}
    .spinner{border:3px solid #eee;border-top:3px solid #6366f1;border-radius:9999px;width:16px;height:16px;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body class="text-gray-800">
  <div class="max-w-6xl mx-auto p-6">
    <header class="flex justify-between items-start gap-4 mb-6">
      <div>
        <h1 class="text-3xl font-bold">AI Agent Hub</h1>
        <p class="text-sm text-gray-600 mt-1">All-in-one AI tools — connect to n8n webhooks in Settings.</p>
      </div>
      <div class="flex items-center gap-3">
        <button id="openSettings" class="px-4 py-2 bg-indigo-600 text-white rounded">Settings</button>
        <a href="dashboard.html" class="px-4 py-2 bg-gray-100 rounded text-gray-700">Dashboard</a>
      </div>
    </header>

    <div id="status" class="small text-gray-600 mb-4">Status: <span id="statusText">No webhooks configured — open Settings.</span></div>

    <main class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">

      <!-- Chat -->
      <section class="card">
        <h3 class="font-semibold">Chat (Conversation)</h3>
        <p class="small text-gray-500">POST { text } → expects { answer }</p>
        <textarea id="chatText" rows="4" class="w-full border mt-2 p-2 rounded"></textarea>
        <div class="flex gap-2 mt-2">
          <button id="sendChat" class="px-4 py-2 bg-indigo-600 text-white rounded">Send</button>
          <button id="clearChat" class="px-3 py-2 bg-gray-100 rounded">Clear</button>
          <div id="chatBusy" class="ml-auto hidden"><span class="spinner"></span></div>
        </div>
        <div id="chatResult" class="mt-3 bg-gray-50 p-3 rounded h-28 overflow-auto small"></div>
      </section>

      <!-- Summarizer -->
      <section class="card">
        <h3 class="font-semibold">Summarizer</h3>
        <p class="small text-gray-500">POST { text, mode:'summary' } → expects { summary }</p>
        <textarea id="sumText" rows="6" class="w-full border mt-2 p-2 rounded"></textarea>
        <div class="flex gap-2 mt-2">
          <button id="sendSum" class="px-4 py-2 bg-green-600 text-white rounded">Summarize</button>
          <button id="clearSum" class="px-3 py-2 bg-gray-100 rounded">Clear</button>
          <div id="sumBusy" class="ml-auto hidden"><span class="spinner"></span></div>
        </div>
        <div id="sumResult" class="mt-3 bg-gray-50 p-3 rounded h-28 overflow-auto small"></div>
      </section>

      <!-- Translator -->
      <section class="card">
        <h3 class="font-semibold">Translator</h3>
        <p class="small text-gray-500">Uses LibreTranslate (client) or proxy via n8n</p>
        <textarea id="transText" rows="4" class="w-full border mt-2 p-2 rounded"></textarea>
        <div class="flex gap-2 mt-2">
          <select id="fromLang" class="p-2 border rounded small"><option value="auto">Auto</option><option value="en">English</option><option value="hi">Hindi</option></select>
          <select id="toLang" class="p-2 border rounded small"><option value="hi">Hindi</option><option value="en" selected>English</option></select>
          <button id="sendTrans" class="px-3 py-2 bg-yellow-600 text-white rounded">Translate</button>
        </div>
        <div id="transResult" class="mt-3 bg-gray-50 p-3 rounded h-24 overflow-auto small"></div>
      </section>

      <!-- Grammar / Rewrite -->
      <section class="card">
        <h3 class="font-semibold">Grammar / Rewrite</h3>
        <p class="small text-gray-500">POST { text, tone } → expects { fixed }</p>
        <textarea id="fixText" rows="4" class="w-full border mt-2 p-2 rounded"></textarea>
        <div class="flex gap-2 mt-2">
          <select id="fixTone" class="p-2 border rounded small"><option value="formal">Formal</option><option value="casual">Casual</option><option value="concise">Concise</option></select>
          <button id="sendFix" class="px-3 py-2 bg-pink-600 text-white rounded">Fix</button>
        </div>
        <div id="fixResult" class="mt-3 bg-gray-50 p-3 rounded h-24 overflow-auto small"></div>
      </section>

      <!-- Image Gen -->
      <section class="card">
        <h3 class="font-semibold">Image Generator</h3>
        <p class="small text-gray-500">POST { prompt, count } → expects { images: [url,...] } or { image_url }</p>
        <input id="imgPrompt" class="w-full border p-2 rounded mt-2" placeholder="e.g. cyberpunk city at sunset"/>
        <div class="flex gap-2 mt-2">
          <input id="imgCount" type="number" min="1" max="4" value="1" class="w-20 p-2 border rounded small"/>
          <button id="sendImg" class="px-3 py-2 bg-indigo-700 text-white rounded">Generate</button>
        </div>
        <div id="imgResult" class="mt-3 bg-gray-50 p-3 rounded h-40 overflow-auto flex items-center justify-center"></div>
      </section>

      <!-- Text to Speech -->
      <section class="card">
        <h3 class="font-semibold">Text-to-Speech (Browser)</h3>
        <p class="small text-gray-500">Browser fallback; for quality voices use ElevenLabs via n8n</p>
        <textarea id="ttsText" rows="3" class="w-full border mt-2 p-2 rounded">Hello from AI Agent Hub</textarea>
        <div class="flex gap-2 mt-2">
          <select id="voiceSelect" class="p-2 border rounded small"></select>
          <button id="playTTS" class="px-3 py-2 bg-green-600 text-white rounded">Play</button>
          <button id="stopTTS" class="px-3 py-2 bg-gray-100 rounded">Stop</button>
        </div>
      </section>

      <!-- Captioner -->
      <section class="card">
        <h3 class="font-semibold">Auto Captioner (Upload)</h3>
        <p class="small text-gray-500">multipart upload → n8n forward to Whisper/AssemblyAI</p>
        <input id="capFile" type="file" accept="audio/*,video/*" class="mt-2"/>
        <div class="flex gap-2 mt-2">
          <button id="sendCap" class="px-3 py-2 bg-purple-600 text-white rounded">Upload & Transcribe</button>
        </div>
        <div id="capResult" class="mt-3 bg-gray-50 p-3 rounded h-32 overflow-auto small"></div>
      </section>

      <!-- Email Writer -->
      <section class="card">
        <h3 class="font-semibold">Email Writer & Sender</h3>
        <p class="small text-gray-500">Generate via chat webhook, send via email webhook (n8n Gmail)</p>
        <input id="emailTo" class="w-full border p-2 rounded mt-2" placeholder="to@example.com"/>
        <input id="emailSub" class="w-full border p-2 rounded mt-2" placeholder="Subject"/>
        <textarea id="emailBody" rows="4" class="w-full border mt-2 p-2 rounded" placeholder="Email body..."></textarea>
        <div class="flex gap-2 mt-2">
          <button id="genEmail" class="px-3 py-2 bg-indigo-600 text-white rounded">Generate</button>
          <button id="sendEmail" class="px-3 py-2 bg-blue-600 text-white rounded">Send</button>
        </div>
        <div id="emailResult" class="mt-3 bg-gray-50 p-3 rounded h-24 overflow-auto small"></div>
      </section>

      <!-- Scheduler simple -->
      <section class="card">
        <h3 class="font-semibold">Scheduler (register task)</h3>
        <p class="small text-gray-500">POST { name, cron } → n8n manages Cron triggers</p>
        <input id="schedName" class="w-full border p-2 rounded mt-2" placeholder="Task name"/>
        <input id="schedCron" class="w-full border p-2 rounded mt-2" placeholder="Cron (e.g. */5 * * * *)"/>
        <div class="flex gap-2 mt-2">
          <button id="schedReg" class="px-3 py-2 bg-yellow-600 text-white rounded">Register</button>
        </div>
        <div id="schedResult" class="mt-3 bg-gray-50 p-3 rounded h-24 overflow-auto small"></div>
      </section>

    </main>

    <footer class="mt-6 small text-gray-500">⚠️ Do not put any provider API keys in frontend. Store them securely in n8n credentials.</footer>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg p-5 max-w-2xl w-full mx-4">
      <div class="flex justify-between items-center mb-3">
        <h4 class="font-semibold">Settings — Paste your n8n webhook URLs</h4>
        <button id="closeSettings" class="text-gray-600">&times;</button>
      </div>
      <div class="space-y-2 small">
        <label class="text-xs text-gray-600">Chat webhook (POST { text })</label>
        <input id="cfgChat" class="w-full border p-2 rounded" placeholder="https://.../webhook/chat"/>
        <label class="text-xs text-gray-600">Summary webhook (POST { text, mode:'summary' })</label>
        <input id="cfgSummary" class="w-full border p-2 rounded" placeholder="https://.../webhook/summary"/>
        <label class="text-xs text-gray-600">Grammar webhook (POST { text, tone })</label>
        <input id="cfgFix" class="w-full border p-2 rounded" placeholder="https://.../webhook/fix"/>
        <label class="text-xs text-gray-600">Image webhook (POST { prompt, count })</label>
        <input id="cfgImage" class="w-full border p-2 rounded" placeholder="https://.../webhook/image"/>
        <label class="text-xs text-gray-600">Caption webhook (multipart file)</label>
        <input id="cfgCaption" class="w-full border p-2 rounded" placeholder="https://.../webhook/caption"/>
        <label class="text-xs text-gray-600">Email webhook (POST { to, subject, body })</label>
        <input id="cfgEmail" class="w-full border p-2 rounded" placeholder="https://.../webhook/email"/>
        <label class="text-xs text-gray-600">Scheduler webhook (POST { name, cron })</label>
        <input id="cfgSched" class="w-full border p-2 rounded" placeholder="https://.../webhook/scheduler"/>
      </div>
      <div class="flex justify-between items-center mt-4">
        <div class="text-xs text-gray-500">Settings saved in browser localStorage for convenience.</div>
        <div class="flex gap-2">
          <button id="saveCfg" class="px-4 py-2 bg-indigo-600 text-white rounded">Save</button>
          <button id="clearCfg" class="px-4 py-2 bg-gray-100 rounded">Clear</button>
        </div>
      </div>
    </div>
  </div>

<script>
/* Helper */
const el = id => document.getElementById(id);
function showStatus(msg){ el('statusText').innerText = msg; }

/* Save/load config */
function loadConfig(){
  const cfg = JSON.parse(localStorage.getItem('ai_cfg')||'{}');
  el('cfgChat').value = cfg.chat||'';
  el('cfgSummary').value = cfg.summary||'';
  el('cfgFix').value = cfg.fix||'';
  el('cfgImage').value = cfg.image||'';
  el('cfgCaption').value = cfg.caption||'';
  el('cfgEmail').value = cfg.email||'';
  el('cfgSched').value = cfg.sched||'';
  const keys = Object.keys(cfg).filter(k=>cfg[k]);
  showStatus(keys.length? 'Configured: ' + keys.join(', '): 'No webhooks configured — open Settings.');
  return cfg;
}
function saveConfig(){
  const cfg = {
    chat: el('cfgChat').value.trim(),
    summary: el('cfgSummary').value.trim(),
    fix: el('cfgFix').value.trim(),
    image: el('cfgImage').value.trim(),
    caption: el('cfgCaption').value.trim(),
    email: el('cfgEmail').value.trim(),
    sched: el('cfgSched').value.trim()
  };
  localStorage.setItem('ai_cfg', JSON.stringify(cfg));
  loadConfig();
}

/* POST helpers */
async function postJSON(url, body){
  try{
    const res = await fetch(url, { method:'POST', headers:{ 'Content-Type':'application/json' }, body: JSON.stringify(body) });
    if(!res.ok) throw new Error('Status '+res.status);
    return await res.json();
  } catch(e){ return { error: e.message || String(e) }; }
}
async function postForm(url, form){
  try{
    const res = await fetch(url, { method:'POST', body: form });
    if(!res.ok) throw new Error('Status '+res.status);
    return await res.json();
  } catch(e){ return { error: e.message || String(e) }; }
}

/* Modal wiring */
el('openSettings').addEventListener('click', ()=> el('settingsModal').classList.remove('hidden'));
el('closeSettings').addEventListener('click', ()=> el('settingsModal').classList.add('hidden'));
el('saveCfg').addEventListener('click', ()=>{ saveConfig(); el('settingsModal').classList.add('hidden'); });
el('clearCfg').addEventListener('click', ()=>{ localStorage.removeItem('ai_cfg'); loadConfig(); });

const cfg = loadConfig();

/* Chat */
el('sendChat').addEventListener('click', async ()=>{
  const text = el('chatText').value.trim(); if(!text) return alert('Type a message');
  const c = loadConfig(); if(!c.chat) return alert('Set Chat webhook in Settings');
  el('chatBusy').classList.remove('hidden');
  el('chatResult').innerHTML = '';
  const resp = await postJSON(c.chat, { text });
  el('chatBusy').classList.add('hidden');
  if(resp.error) el('chatResult').innerHTML = `<div class="text-red-600 small">Error: ${resp.error}</div>`;
  else el('chatResult').innerHTML = `<div class="whitespace-pre-wrap">${resp.answer || resp.result || JSON.stringify(resp)}</div>`;
});
el('clearChat').addEventListener('click', ()=>{ el('chatText').value=''; el('chatResult').innerHTML=''; });

/* Summarizer */
el('sendSum').addEventListener('click', async ()=>{
  const text = el('sumText').value.trim(); if(!text) return alert('Paste text to summarize');
  const c = loadConfig(); const url = c.summary || c.chat; if(!url) return alert('Set Summary or Chat webhook');
  el('sumBusy').classList.remove('hidden'); el('sumResult').innerHTML='';
  const resp = await postJSON(url, { text, mode:'summary' });
  el('sumBusy').classList.add('hidden');
  if(resp.error) el('sumResult').innerHTML = `<div class="text-red-600 small">Error: ${resp.error}</div>`;
  else el('sumResult').innerHTML = `<div class="whitespace-pre-wrap">${resp.summary||resp.result||JSON.stringify(resp)}</div>`;
});
el('clearSum').addEventListener('click', ()=>{ el('sumText').value=''; el('sumResult').innerHTML=''; });

/* Translator */
el('sendTrans').addEventListener('click', async ()=>{
  const q = el('transText').value.trim(); if(!q) return alert('Type text to translate');
  el('transResult').innerHTML = '<div class="small text-gray-500">Translating... <span class="spinner inline-block"></span></div>';
  try{
    const from = el('fromLang').value, to = el('toLang').value;
    const r = await fetch('https://libretranslate.de/translate', { method:'POST', headers:{ 'Content-Type':'application/json' }, body: JSON.stringify({ q, source: from==='auto'?'auto':from, target: to, format:'text' })});
    if(!r.ok) throw new Error('Status '+r.status);
    const j = await r.json();
    el('transResult').innerHTML = `<div class="whitespace-pre-wrap">${j.translatedText||JSON.stringify(j)}</div>`;
  } catch(e){ el('transResult').innerHTML = `<div class="text-red-600 small">Error: ${e}</div>`; }
});

/* Grammar Fix */
el('sendFix').addEventListener('click', async ()=>{
  const text = el('fixText').value.trim(); if(!text) return alert('Enter text');
  const tone = el('fixTone').value; const c = loadConfig(); if(!c.fix) return alert('Set Grammar webhook');
  el('fixResult').innerHTML = '<div class="small text-gray-500">Fixing... <span class="spinner inline-block"></span></div>';
  const resp = await postJSON(c.fix, { text, tone });
  if(resp.error) el('fixResult').innerHTML = `<div class="text-red-600 small">Error: ${resp.error}</div>`;
  else el('fixResult').innerHTML = `<div class="whitespace-pre-wrap">${resp.fixed||resp.result||JSON.stringify(resp)}</div>`;
});

/* Image */
el('sendImg').addEventListener('click', async ()=>{
  const prompt = el('imgPrompt').value.trim(); if(!prompt) return alert('Enter prompt');
  const count = parseInt(el('imgCount').value)||1; const c = loadConfig(); if(!c.image) return alert('Set Image webhook');
  el('imgResult').innerHTML = '<div class="small text-gray-500">Generating... <span class="spinner inline-block"></span></div>';
  const resp = await postJSON(c.image, { prompt, count });
  if(resp.error) el('imgResult').innerHTML = `<div class="text-red-600 small">Error: ${resp.error}</div>`;
  else {
    if(resp.images && Array.isArray(resp.images)) el('imgResult').innerHTML = resp.images.map(u=>`<img src="${u}" class="max-h-32 m-1 rounded">`).join('');
    else if(resp.image_url) el('imgResult').innerHTML = `<img src="${resp.image_url}" class="max-h-40 rounded">`;
    else if(resp.image_b64) el('imgResult').innerHTML = `<img src="data:image/png;base64,${resp.image_b64}" class="max-h-40 rounded">`;
    else el('imgResult').innerHTML = `<pre class="small">${JSON.stringify(resp,null,2)}</pre>`;
  }
});

/* TTS */
function populateVoices(){ const sel = el('voiceSelect'); sel.innerHTML=''; const v = speechSynthesis.getVoices(); v.forEach(x=>{ const o=document.createElement('option'); o.value=x.name; o.textContent=`${x.name} (${x.lang})`; sel.appendChild(o); }); }
if('speechSynthesis' in window){ populateVoices(); window.speechSynthesis.onvoiceschanged = populateVoices; }
el('playTTS').addEventListener('click', ()=>{ const t=el('ttsText').value.trim(); if(!t) return alert('Enter text'); if('speechSynthesis' in window){ window.speechSynthesis.cancel(); const u=new SpeechSynthesisUtterance(t); const sel=el('voiceSelect').value; if(sel){ const v=speechSynthesis.getVoices().find(x=>x.name===sel); if(v) u.voice=v; } window.speechSynthesis.speak(u); } else alert('TTS not supported'); });
el('stopTTS').addEventListener('click', ()=>{ if(window.speechSynthesis) window.speechSynthesis.cancel(); });

/* Captioner */
el('sendCap').addEventListener('click', async ()=>{
  const f = el('capFile').files[0]; if(!f) return alert('Choose file');
  const c = loadConfig(); if(!c.caption) return alert('Set Caption webhook');
  el('capResult').innerHTML = '<div class="small text-gray-500">Uploading... <span class="spinner inline-block"></span></div>';
  const fd = new FormData(); fd.append('file', f);
  const resp = await postForm(c.caption, fd);
  if(resp.error) el('capResult').innerHTML = `<div class="text-red-600 small">Error: ${resp.error}</div>`;
  else {
    el('capResult').innerHTML = (resp.transcript? `<div class="whitespace-pre-wrap">${resp.transcript}</div>`:'') + (resp.srt_url? `<div class="mt-2"><a class="text-indigo-600 small" href="${resp.srt_url}" target="_blank">Download SRT</a></div>`:'');
  }
});

/* Email */
el('genEmail').addEventListener('click', async ()=>{
  const to = el('emailTo').value.trim(), sub = el('emailSub').value.trim(), body = el('emailBody').value.trim();
  if(!to && !body) return alert('Provide recipient or body');
  const c = loadConfig(); const url = c.chat || c.summary; if(!url) return alert('Set Chat/Summary webhook to generate');
  el('emailResult').innerHTML = '<div class="small text-gray-500">Generating... <span class="spinner inline-block"></span></div>';
  const resp = await postJSON(url, { prompt:`Write an email to:${to} subject:${sub} body:${body}`, mode:'email' });
  if(resp.error) el('emailResult').innerHTML = `<div class="text-red-600 small">Error: ${resp.error}</div>`;
  else el('emailResult').innerHTML = `<div class="whitespace-pre-wrap">${resp.email||resp.result||JSON.stringify(resp)}</div>`;
});
el('sendEmail').addEventListener('click', async ()=>{
  const to = el('emailTo').value.trim(), sub = el('emailSub').value.trim(), body = el('emailBody').value.trim();
  if(!to||!sub||!body) return alert('Fill to, subject, body');
  const c = loadConfig(); if(!c.email) return alert('Set Email webhook');
  el('emailResult').innerHTML = '<div class="small text-gray-500">Sending... <span class="spinner inline-block"></span></div>';
  const resp = await postJSON(c.email, { to, subject: sub, body });
  if(resp.error) el('emailResult').innerHTML = `<div class="text-red-600 small">Error: ${resp.error}</div>`;
  else el('emailResult').innerHTML = `<div class="text-green-600 small">Sent: ${resp.message||JSON.stringify(resp)}</div>`;
});

/* Scheduler */
el('schedReg').addEventListener('click', async ()=>{
  const name = el('schedName').value.trim(), cron = el('schedCron').value.trim(); if(!name||!cron) return alert('Provide name and cron');
  const c = loadConfig(); if(!c.sched) return alert('Set Scheduler webhook');
  el('schedResult').innerHTML = '<div class="small text-gray-500">Registering... <span class="spinner inline-block"></span></div>';
  const resp = await postJSON(c.sched, { name, cron });
  if(resp.error) el('schedResult').innerHTML = `<div class="text-red-600 small">Error: ${resp.error}</div>`;
  else el('schedResult').innerHTML = `<div class="whitespace-pre-wrap">${resp.message||JSON.stringify(resp)}</div>`;
});

/* Init */
document.addEventListener('DOMContentLoaded', ()=>{ loadConfig(); el('settingsModal').classList.add('hidden'); el('closeSettings').addEventListener('click', ()=> el('settingsModal').classList.add('hidden')); });
</script>
</body>
</html>
